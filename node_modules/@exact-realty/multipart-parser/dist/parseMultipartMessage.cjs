"use strict";var E=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var k=Object.prototype.hasOwnProperty;var v=(e,r)=>{for(var n in r)E(e,n,{get:r[n],enumerable:!0})},G=(e,r,n,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let s of _(r))!k.call(e,s)&&s!==n&&E(e,s,{get:()=>r[s],enumerable:!(a=N(r,s))||a.enumerable});return e};var j=e=>G(E({},"__esModule",{value:!0}),e);var H={};v(H,{default:()=>m,parseMultipartMessage:()=>m});module.exports=j(H);var I=/^[0-9a-zA-Z'()+_,\-./:=? ]{0,69}[0-9a-zA-Z'()+_,\-./:=?]$/,L=/;\s*boundary=(?:"([0-9a-zA-Z'()+_,\-./:=? ]{0,69}[0-9a-zA-Z'()+_,\-./:=?])"|([0-9a-zA-Z'+_\-.]{0,69}[0-9a-zA-Z'+_\-.]))/;var D=e=>new ReadableStream({pull(n){if(ArrayBuffer.isView(e))n.enqueue(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));else if(e instanceof ArrayBuffer)n.enqueue(e);else throw new TypeError("Expected ArrayBuffer or an ArrayBuffer view.");n.close()}}),P=D;var z=(e,r)=>{e:for(let n=0;n<=e.length-r.length;n++){for(let a=0;a<r.length;a++)if(e[n+a]!==r[a])continue e;return n}return-1},l=z;var Z=(e,...r)=>{let n=r.reduce((i,t)=>i+t.byteLength,e.length),a=new(Object(r[0])).constructor(n);a.set(e);let s=e.length;return r.forEach(i=>{a.set(i,s),s+=i.byteLength}),a},B=Z;var S=new TextDecoder,$=new TextEncoder,h=$.encode(`\r
`),C=[9,32],Y=e=>{let r=0,n=[];for(;(r=l(e,h))!==-1&&r!==0;){let s=e.indexOf(58);if(s===-1)throw new Error("Invalid header");let i=S.decode(e.subarray(0,s));for(;C.includes(e[r+2]);){let d=l(e.subarray(r+2),h);if(d<1)break;r+=2+d}let t=S.decode(e.subarray(s+1,r)).replace(/\r\n/g,"");n.push([i,t]),e=e.subarray(r+h.length)}let a=new Headers(n);return a.has("content-transfer-encoding")||a.set("content-transfer-encoding","7bit"),a.has("content-type")||a.set("content-type","text/plain; charset=us-ascii"),{headers:a,body:r===-1?null:e.subarray(r+h.length)}},O=Y;async function*R(e,r){var M;if(!I.test(r))throw new Error("Invalid boundary delimiter");let n=new TextEncoder,a=[9,32],s=new Uint8Array([13,10]),i=n.encode(`\r
--${r}`),t=new Uint8Array,d=0,b=!1,w=e.getReader();try{for(;d!==3;){let{done:A,value:p}=await w.read();if(A){if(t.length===0||b)throw new Error("Invalid message");b=!0}else t=B(t,ArrayBuffer.isView(p)?new Uint8Array(p.buffer,p.byteOffset,p.byteLength):new Uint8Array(p));for(;t.length>0;){let y=NaN;if(d===0&&(y=l(t,i.slice(2))-2,y===-3)||(y!==-2&&(y=l(t,i)),y===-1))break;let o=y+i.length,c=A?0:l(t.subarray(o,o+32),s);if(c===-1&&t.length-o<32)break;if(c===-1||!Array.from(t.subarray(o+Math.min(2,c),o+c)).every(g=>a.includes(g)))throw new Error(`Invalid boundary at index ${y}`);if(A||c>=2){if([1,2].includes(d)&&t[o+0]===t[o+1]&&t[o+0]===45)d=3;else if(!a.includes(t[o+0])||!a.includes(t[o+1]))throw new Error(`Invalid boundary at index ${y} (${r}): ${(M=t[o+1])==null?void 0:M.toString(16)}`)}switch(d){case 0:d=1;break;case 1:d=2;case 2:case 3:if(t.subarray(y,o).length>0){let g=t.subarray(0,y),u=O(g),f=u.headers.get("content-type"),x;if(u.body&&(f!=null&&f.startsWith("multipart/"))){let T=f.match(L);if(T){let U=T[1]||T[2];x=R(P(u.body),U)}else x=null}yield{headers:u.headers,body:u.body,...x!==void 0&&{parts:x}}}break}if(d===3){t=t.subarray(t.length);break}t=t.subarray(c+o+2)}}}finally{w.releaseLock()}}var m=R;0&&(module.exports={parseMultipartMessage});
