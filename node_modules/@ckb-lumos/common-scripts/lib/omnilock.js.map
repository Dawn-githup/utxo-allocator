{"version":3,"file":"omnilock.js","names":["_codec","require","_base","_configManager","_helper","_from_info","_molecule","_blockchain","_bytes","bitcoin","_interopRequireWildcard","exports","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","ScriptValue","values","IdentityFlagsType","createOmnilockScript","omnilockInfo","options","config","getConfig","omnilockConfig","SCRIPTS","OMNILOCK","Error","omnilockArgs","args","flag","auth","bytes","hexify","concat","IdentityFlagsEthereum","content","IdentityFlagsCkb","IdentityFlagsBitcoin","decodeAddress","codeHash","CODE_HASH","hashType","HASH_TYPE","Hexify","pack","bytify","unpack","Identity","createFixedHexBytesCodec","SmtProof","byteVecOf","SmtProofEntry","table","mask","byteOf","proof","SmtProofEntryVec","vector","OmniIdentity","identity","proofs","OmniIdentityOpt","option","OmnilockWitnessLock","signature","BytesOpt","omni_identity","preimage","CellCollector","constructor","fromInfo","cellProvider","undefined","queryOptions","fromScript","parseFromInfo","lock","type","cellCollector","collector","collect","isOmnilockScript","inputCell","setupInputCell","txSkeleton","_fromInfo","defaultWitness","since","cellOutput","update","inputs","push","output","capacity","data","outputs","inputSinces","size","witnesses","template","secp256k1Template","SECP256K1_BLAKE160","omnilockOutPoint","txHash","TX_HASH","index","INDEX","secp256k1OutPoint","addCellDep","outPoint","depType","DEP_TYPE","firstIndex","findIndex","input","validate","equals","witness","newWitnessArgs","OMNILOCK_SIGNATURE_PLACEHOLDER","blockchain","WitnessArgs","prepareSigningEntries","_prepareSigningEntries","_default"],"sources":["../src/omnilock.ts"],"sourcesContent":["import { Options, TransactionSkeletonType } from \"@ckb-lumos/helpers\";\nimport { bytes, BytesLike } from \"@ckb-lumos/codec\";\nimport {\n  blockchain,\n  Cell,\n  CellCollector as CellCollectorType,\n  CellProvider,\n  HexString,\n  OutPoint,\n  PackedSince,\n  QueryOptions,\n  Script,\n  values,\n  WitnessArgs,\n} from \"@ckb-lumos/base\";\nimport { Config, getConfig } from \"@ckb-lumos/config-manager\";\nimport {\n  addCellDep,\n  isOmnilockScript,\n  OMNILOCK_SIGNATURE_PLACEHOLDER,\n  prepareSigningEntries as _prepareSigningEntries,\n} from \"./helper\";\nimport { FromInfo } from \".\";\nimport { parseFromInfo } from \"./from_info\";\nimport { CellCollectorConstructor } from \"./type\";\nimport {\n  byteOf,\n  byteVecOf,\n  option,\n  table,\n  vector,\n} from \"@ckb-lumos/codec/lib/molecule\";\nimport {\n  BytesOpt,\n  createFixedHexBytesCodec,\n} from \"@ckb-lumos/codec/lib/blockchain\";\nimport { bytify, hexify } from \"@ckb-lumos/codec/lib/bytes\";\nimport * as bitcoin from \"./omnilock-bitcoin\";\n\nconst { ScriptValue } = values;\n\nexport type OmnilockInfo = {\n  auth: OmnilockAuth;\n};\n\nexport type OmnilockAuth = IdentityCkb | IdentityEthereum | IdentityBitcoin;\n\nexport type IdentityCkb = {\n  flag: \"SECP256K1_BLAKE160\";\n  /**\n   * the blake160 hash of a secp256k1 public key\n   */\n  content: BytesLike;\n};\nexport type IdentityEthereum = {\n  flag: \"ETHEREUM\";\n\n  /**\n   * an Ethereum address, aka the public key hash\n   */\n  content: BytesLike;\n};\nexport type IdentityBitcoin = {\n  flag: \"BITCOIN\";\n  /**\n   * a Bitcoin address, such as\n   * `P2PKH(17VZNX1SN5NtKa8UQFxwQbFeFc3iqRYhem)`,\n   * `P2SH(3EktnHQD7RiAE6uzMj2ZifT9YgRrkSgzQX)`,\n   * `Bech32(bc1qw508d6qejxtdg4y5r3zarvary0c5xw7kv8f3t4)`\n   */\n  content: string;\n};\n\n// https://github.com/XuJiandong/omnilock/blob/4e9fdb6ca78637651c8145bb7c5b82b4591332fb/c/ckb_identity.h#L62-L76\nenum IdentityFlagsType {\n  IdentityFlagsCkb = 0,\n  IdentityFlagsEthereum = 1,\n  IdentityFlagsEos = 2,\n  IdentityFlagsTron = 3,\n  IdentityFlagsBitcoin = 4,\n  IdentityFlagsDogecoin = 5,\n  IdentityCkbMultisig = 6,\n  IdentityFlagsEthereumDisplaying = 18,\n  IdentityFlagsOwnerLock = 0xfc,\n  IdentityFlagsExec = 0xfd,\n  IdentityFlagsDl = 0xfe,\n}\n\n/**\n * only support ETHEREUM and SECP256K1_BLAKE160 mode currently\n * refer to: @link https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0042-omnilock/0042-omnilock.md omnilock\n * @param omnilockInfo\n * @param options\n * @returns\n * @example\n * // create an omnilock to work with MetaMask wallet\n * createOmnilockScript({\n *   auth: {\n *     flag: \"ETHEREUM\",\n *     content: \"an ethereum address here\",\n *   }, { config })\n * // or we can create an omnilock to work with UniSat wallet\n * createOmnilockScript({\n *   auth: {\n *     flag: \"BITCOIN\",\n *     content: \"a bitcoin address here\",\n *   }\n * }, {config})\n */\nexport function createOmnilockScript(\n  omnilockInfo: OmnilockInfo,\n  options?: Options\n): Script {\n  const config = options?.config || getConfig();\n  const omnilockConfig = config.SCRIPTS.OMNILOCK;\n  if (!omnilockConfig) {\n    throw new Error(\"OMNILOCK script config not found.\");\n  }\n\n  // TODO The advanced feature will be supported in the future.\n  // https://github.com/nervosnetwork/rfcs/blob/master/rfcs/0042-omnilock/0042-omnilock.md\n  /**\n   * |Name                 |Flags     |Affected Args              |Affected Args Size (byte)|Affected Witness|\n   * |---------------------|----------|---------------------------|-------------------------|----------------|\n   * |administrator mode   |0b00000001|AdminList cell Type ID     |32                       |omni_identity/signature in OmniLockWitnessLock|\n   * |anyone-can-pay mode  |0b00000010|minimum ckb/udt in ACP     |2                        |N/A             |\n   * |time-lock mode       |0b00000100|since for timelock         |8                        |N/A             |\n   * |supply mode          |0b00001000|type script hash for supply|32                       |N/A             |\n   */\n  const omnilockArgs = [0b00000000];\n\n  const args = (() => {\n    const flag = omnilockInfo.auth.flag;\n    switch (flag) {\n      case \"ETHEREUM\":\n        return bytes.hexify(\n          bytes.concat(\n            [IdentityFlagsType.IdentityFlagsEthereum],\n            omnilockInfo.auth.content,\n            omnilockArgs\n          )\n        );\n      case \"SECP256K1_BLAKE160\":\n        return bytes.hexify(\n          bytes.concat(\n            [IdentityFlagsType.IdentityFlagsCkb],\n            omnilockInfo.auth.content,\n            omnilockArgs\n          )\n        );\n      case \"BITCOIN\":\n        return bytes.hexify(\n          bytes.concat(\n            [IdentityFlagsType.IdentityFlagsBitcoin],\n            bitcoin.decodeAddress(omnilockInfo.auth.content),\n            omnilockArgs\n          )\n        );\n      default:\n        throw new Error(`Not supported flag: ${flag}.`);\n    }\n  })();\n\n  return {\n    codeHash: omnilockConfig.CODE_HASH,\n    hashType: omnilockConfig.HASH_TYPE,\n    args,\n  };\n}\n\nconst Hexify = { pack: bytify, unpack: hexify };\nconst Identity = createFixedHexBytesCodec(21);\nconst SmtProof = byteVecOf(Hexify);\nconst SmtProofEntry = table(\n  {\n    mask: byteOf(Hexify),\n    proof: SmtProof,\n  },\n  [\"mask\", \"proof\"]\n);\nconst SmtProofEntryVec = vector(SmtProofEntry);\nconst OmniIdentity = table(\n  {\n    identity: Identity,\n    proofs: SmtProofEntryVec,\n  },\n  [\"identity\", \"proofs\"]\n);\nconst OmniIdentityOpt = option(OmniIdentity);\nexport const OmnilockWitnessLock = table(\n  {\n    signature: BytesOpt,\n    omni_identity: OmniIdentityOpt,\n    preimage: BytesOpt,\n  },\n  [\"signature\", \"omni_identity\", \"preimage\"]\n);\n\nexport const CellCollector: CellCollectorConstructor = class CellCollector\n  implements CellCollectorType\n{\n  private cellCollector: CellCollectorType;\n  private config: Config;\n  public readonly fromScript: Script;\n\n  constructor(\n    fromInfo: FromInfo,\n    cellProvider: CellProvider,\n    {\n      config = undefined,\n      queryOptions = {},\n    }: Options & {\n      queryOptions?: QueryOptions;\n    } = {}\n  ) {\n    if (!cellProvider) {\n      throw new Error(`Cell provider is missing!`);\n    }\n    config = config || getConfig();\n    this.fromScript = parseFromInfo(fromInfo, { config }).fromScript;\n\n    this.config = config;\n\n    queryOptions = {\n      ...queryOptions,\n      lock: this.fromScript,\n      type: queryOptions.type || \"empty\",\n    };\n\n    this.cellCollector = cellProvider.collector(queryOptions);\n  }\n\n  async *collect(): AsyncGenerator<Cell> {\n    if (!isOmnilockScript(this.fromScript, this.config)) {\n      return;\n    }\n\n    for await (const inputCell of this.cellCollector.collect()) {\n      yield inputCell;\n    }\n  }\n};\n\n/**\n * Setup input cell infos, such as cell deps and witnesses.\n *\n * @param txSkeleton\n * @param inputCell\n * @param _fromInfo\n * @param options\n */\nexport async function setupInputCell(\n  txSkeleton: TransactionSkeletonType,\n  inputCell: Cell,\n  _fromInfo?: FromInfo,\n  {\n    config = undefined,\n    defaultWitness = \"0x\",\n    since = undefined,\n  }: Options & {\n    defaultWitness?: HexString;\n    since?: PackedSince;\n  } = {}\n): Promise<TransactionSkeletonType> {\n  config = config || getConfig();\n\n  const fromScript = inputCell.cellOutput.lock;\n  if (!isOmnilockScript(fromScript, config)) {\n    throw new Error(`Not OMNILOCK input!`);\n  }\n\n  // add inputCell to txSkeleton\n  txSkeleton = txSkeleton.update(\"inputs\", (inputs) => {\n    return inputs.push(inputCell);\n  });\n\n  const output: Cell = {\n    cellOutput: {\n      capacity: inputCell.cellOutput.capacity,\n      lock: inputCell.cellOutput.lock,\n      type: inputCell.cellOutput.type,\n    },\n    data: inputCell.data,\n  };\n\n  txSkeleton = txSkeleton.update(\"outputs\", (outputs) => {\n    return outputs.push(output);\n  });\n\n  if (since) {\n    txSkeleton = txSkeleton.update(\"inputSinces\", (inputSinces) => {\n      return inputSinces.set(txSkeleton.get(\"inputs\").size - 1, since);\n    });\n  }\n\n  txSkeleton = txSkeleton.update(\"witnesses\", (witnesses) => {\n    return witnesses.push(defaultWitness);\n  });\n\n  const template = config.SCRIPTS.OMNILOCK;\n  const secp256k1Template = config.SCRIPTS.SECP256K1_BLAKE160;\n  if (!template) {\n    throw new Error(`OMNILOCK script not defined in config!`);\n  }\n  if (!secp256k1Template) {\n    throw new Error(`SECP256K1_BLAKE160 script not defined in config!`);\n  }\n\n  const omnilockOutPoint: OutPoint = {\n    txHash: template.TX_HASH,\n    index: template.INDEX,\n  };\n  const secp256k1OutPoint: OutPoint = {\n    txHash: secp256k1Template.TX_HASH,\n    index: secp256k1Template.INDEX,\n  };\n\n  // add cell dep\n  txSkeleton = addCellDep(txSkeleton, {\n    outPoint: omnilockOutPoint,\n    depType: template.DEP_TYPE,\n  });\n  txSkeleton = addCellDep(txSkeleton, {\n    outPoint: secp256k1OutPoint,\n    depType: secp256k1Template.DEP_TYPE,\n  });\n\n  // add witness\n  /*\n   * Modify the skeleton, so the first witness of the fromAddress script group\n   * has a WitnessArgs construct with 85-byte zero filled values. While this\n   * is not required, it helps in transaction fee estimation.\n   */\n  const firstIndex = txSkeleton\n    .get(\"inputs\")\n    .findIndex((input) =>\n      new ScriptValue(input.cellOutput.lock, { validate: false }).equals(\n        new ScriptValue(fromScript, { validate: false })\n      )\n    );\n  if (firstIndex !== -1) {\n    while (firstIndex >= txSkeleton.get(\"witnesses\").size) {\n      txSkeleton = txSkeleton.update(\"witnesses\", (witnesses) =>\n        witnesses.push(\"0x\")\n      );\n    }\n    let witness: string = txSkeleton.get(\"witnesses\").get(firstIndex)!;\n    const newWitnessArgs: WitnessArgs = {\n      /* 85-byte zeros in hex */\n      lock: OMNILOCK_SIGNATURE_PLACEHOLDER,\n    };\n    witness = bytes.hexify(blockchain.WitnessArgs.pack(newWitnessArgs));\n    txSkeleton = txSkeleton.update(\"witnesses\", (witnesses) =>\n      witnesses.set(firstIndex, witness)\n    );\n  }\n\n  return txSkeleton;\n}\n\n/**\n * prepare for txSkeleton signingEntries, will update txSkeleton.get(\"signingEntries\")\n *\n * @param txSkeleton\n * @param options\n */\nexport function prepareSigningEntries(\n  txSkeleton: TransactionSkeletonType,\n  { config = undefined }: Options = {}\n): TransactionSkeletonType {\n  config = config || getConfig();\n\n  return _prepareSigningEntries(txSkeleton, config, \"OMNILOCK\");\n}\n\nexport { bitcoin };\n\nexport default {\n  prepareSigningEntries,\n  setupInputCell,\n  CellCollector,\n  OmnilockWitnessLock,\n  createOmnilockScript,\n};\n"],"mappings":"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"}