{"version":3,"file":"omnilock-solana.js","names":["_codec","require","COMMON_PREFIX","signMessage","digest","provider","internal","window","phantom","solana","Error","hexPrefixLength","digestWithout0x","bytes","hexify","slice","signed","TextEncoder","encode","concat","signature","publicKey","toBytes"],"sources":["../src/omnilock-solana.ts"],"sourcesContent":["import { BytesLike, bytes } from \"@ckb-lumos/codec\";\n\n// https://github.com/XuJiandong/omnilock/blob/5c25d6a1a48f7d5984170aa501d5567281ba1a4c/c/ckb_identity.h#L36\nconst COMMON_PREFIX = \"CKB transaction: 0x\";\n\nexport interface PublicKey {\n  toBase58(): string;\n  toBytes(): Uint8Array;\n}\n\nexport interface Provider {\n  connect(): Promise<{ publicKey: PublicKey }>;\n  signMessage(\n    message: Uint8Array\n  ): Promise<{ signature: Uint8Array; publicKey: PublicKey }>;\n}\n\ndeclare global {\n  interface Window {\n    phantom?: {\n      solana: Provider;\n    };\n  }\n}\n\nexport async function signMessage(\n  digest: BytesLike,\n  provider?: Provider\n): Promise<string> {\n  const internal: Provider = (() => {\n    if (provider) return provider;\n\n    /* c8 ignore start */\n    if (\n      typeof window !== \"undefined\" &&\n      \"phantom\" in window &&\n      window.phantom &&\n      \"solana\" in window.phantom\n    ) {\n      return window.phantom.solana;\n    }\n\n    throw new Error(\n      \"No provider found, make sure you have installed Phantom or other Solana wallet\"\n    );\n    /* c8 ignore stop */\n  })();\n\n  // '0x'.length\n  const hexPrefixLength = 2;\n  const digestWithout0x = bytes.hexify(digest).slice(hexPrefixLength);\n  const signed = await internal.signMessage(\n    new TextEncoder().encode(`${COMMON_PREFIX}${digestWithout0x}`)\n  );\n\n  return bytes.hexify(\n    bytes.concat(signed.signature, signed.publicKey.toBytes())\n  );\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,OAAA;AAEA;AACA,MAAMC,aAAa,GAAG,qBAAqB;AAsBpC,eAAeC,WAAWA,CAC/BC,MAAiB,EACjBC,QAAmB,EACF;EACjB,MAAMC,QAAkB,GAAG,CAAC,MAAM;IAChC,IAAID,QAAQ,EAAE,OAAOA,QAAQ;;IAE7B;IACA,IACE,OAAOE,MAAM,KAAK,WAAW,IAC7B,SAAS,IAAIA,MAAM,IACnBA,MAAM,CAACC,OAAO,IACd,QAAQ,IAAID,MAAM,CAACC,OAAO,EAC1B;MACA,OAAOD,MAAM,CAACC,OAAO,CAACC,MAAM;IAC9B;IAEA,MAAM,IAAIC,KAAK,CACb,gFACF,CAAC;IACD;EACF,CAAC,EAAE,CAAC;;EAEJ;EACA,MAAMC,eAAe,GAAG,CAAC;EACzB,MAAMC,eAAe,GAAGC,YAAK,CAACC,MAAM,CAACV,MAAM,CAAC,CAACW,KAAK,CAACJ,eAAe,CAAC;EACnE,MAAMK,MAAM,GAAG,MAAMV,QAAQ,CAACH,WAAW,CACvC,IAAIc,WAAW,CAAC,CAAC,CAACC,MAAM,CAAE,GAAEhB,aAAc,GAAEU,eAAgB,EAAC,CAC/D,CAAC;EAED,OAAOC,YAAK,CAACC,MAAM,CACjBD,YAAK,CAACM,MAAM,CAACH,MAAM,CAACI,SAAS,EAAEJ,MAAM,CAACK,SAAS,CAACC,OAAO,CAAC,CAAC,CAC3D,CAAC;AACH","ignoreList":[]}